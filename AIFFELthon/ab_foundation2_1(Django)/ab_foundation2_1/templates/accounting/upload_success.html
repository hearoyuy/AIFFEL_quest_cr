{# templates/accounting/upload_success.html #}
{% extends "base.html" %}

{% block content %}
<div class="w-full flex justify-center mt-6">
  <div class="bg-white shadow rounded-xl p-6 max-w-lg w-full"> <div class="text-center text-xl mb-4 font-semibold">ğŸš€ ì—…ë¡œë“œ ì²˜ë¦¬ ê²°ê³¼</div>

      {% if just_uploaded_files %}
        <p class="mb-2 text-sm text-gray-700">ë‹¤ìŒ íŒŒì¼ë“¤ì´ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤:</p>
        <table class="w-full text-sm border mb-6">
          <thead class="bg-gray-100">
            <tr>
              <th class="py-1 px-2 text-left w-12">NO</th>
              <th class="py-1 px-2 text-left">íŒŒì¼ëª… (ì„œë²„ ì €ì¥ëª…)</th>
              <th class="py-1 px-2 text-left">ë§í¬</th>
            </tr>
          </thead>
          <tbody>
            {% for f in just_uploaded_files %}
            <tr class="border-t">
              <td class="py-1 px-2 text-center">{{ forloop.counter }}</td>
              <td class="py-1 px-2">
                {{ f.name }}
                {% if f.saved_as and f.name != f.saved_as %}
                  <span class="text-xs text-gray-500">({{ f.saved_as }})</span>
                {% endif %}
              </td>
              <td class="py-1 px-2">
                <a href="{{ f.url }}" class="text-blue-600 hover:underline" target="_blank">ì›ë³¸ ë³´ê¸°</a>
              </td>
            </tr>
            {% empty %}
            <tr><td colspan="3" class="py-2 text-center text-gray-500">ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        {% if not duplicate_files %} <p class="py-2 text-center text-gray-500">ì—…ë¡œë“œëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        {% endif %}
      {% endif %}

      {% if duplicate_files %}
        <p class="mb-2 text-sm text-red-700 font-semibold">ë‹¤ìŒ íŒŒì¼ë“¤ì€ ì¤‘ë³µë˜ì–´ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤:</p>
        <table class="w-full text-sm border border-red-300 mb-6">
          <thead class="bg-red-100">
            <tr>
              <th class="py-1 px-2 text-left w-12">NO</th>
              <th class="py-1 px-2 text-left">íŒŒì¼ëª…</th>
              <th class="py-1 px-2 text-left">ì‚¬ìœ </th>
            </tr>
          </thead>
          <tbody>
            {% for d_file in duplicate_files %}
            <tr class="border-t border-red-300">
              <td class="py-1 px-2 text-center">{{ forloop.counter }}</td>
              <td class="py-1 px-2">{{ d_file.name }}</td>
              <td class="py-1 px-2 text-red-600">{{ d_file.reason }}</td>
            </tr>
            {% empty %}
             <tr><td colspan="3" class="py-2 text-center text-gray-500">ì¤‘ë³µëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      {% endif %}

      <div class="text-center"> <a href="{% url 'upload' %}"
           class="inline-flex items-center gap-1 px-6 py-2 bg-indigo-50
                  hover:bg-indigo-100 rounded-lg text-indigo-600 text-sm font-medium">
          â• ì¶”ê°€ ì—…ë¡œë“œ
        </a>
      </div>
  </div>
</div>

<div class="max-w-5xl mx-auto mt-10">
  <h3 class="text-lg font-semibold mb-3">ìµœê·¼ ì—…ë¡œë“œ ê¸°ë¡ (DB)</h3>

  <table class="table-auto w-full text-sm border">
    <thead class="bg-gray-100">
      <tr>
        <th class="px-2 py-1">ì›ë³¸ íŒŒì¼</th>
        <th class="px-2 py-1">ë³€í™˜ íŒŒì¼</th>
        {# <th class="px-2 py-1">ë¬¸ì„œ íƒ€ì…</th> #} {# "ë¬¸ì„œ íƒ€ì…" í—¤ë” ì‚­ì œ #}
        <th class="px-2 py-1">ì—…ë¡œë“œ ì‹œê°</th>
        <th class="px-2 py-1 text-center">ì²˜ë¦¬</th>
      </tr>
    </thead>
    <tbody>
      {% for file_obj in recent_db_files %} {# ì»¨í…ìŠ¤íŠ¸ ë³€ìˆ˜ëª…ì— ë§ì¶° recent_db_files ì‚¬ìš© #}
      <tr class="border-t">
        <td class="px-2 py-1">{{ file_obj.original_filename }}</td>
        <td class="px-2 py-1">
          {% if file_obj.new_filepath %} {# FileField ê°ì²´ì˜ ì¡´ì¬ ìœ ë¬´ë¡œ í™•ì¸ #}
            <a href="{{ file_obj.new_filepath.url }}" class="text-blue-600 hover:underline" target="_blank">
              {{ file_obj.new_filename|default:"ë³€í™˜ íŒŒì¼ ë³´ê¸°" }} {# new_filename í•„ë“œ í‘œì‹œ #}
            </a>
          {% else %} â€” {% endif %}
        </td>
        {# <td class="px-2 py-1">{{ file_obj.get_transaction_document_type_display|default:"â€”" }}</td> #} {# "ë¬¸ì„œ íƒ€ì…" ë°ì´í„° ì‚­ì œ #}
        <td class="px-2 py-1">{{ file_obj.uploaded_at|date:"Yâ€‘mâ€‘d H:i" }}</td>
        <td class="px-2 py-1 text-center">
          {% if file_obj.is_processed %}âœ…{% else %}âŒ›{% endif %}
        </td>
      </tr>
      {% empty %}
      {# ì»¬ëŸ¼ ìˆ˜ê°€ 4ê°œë¡œ ì¤„ì—ˆìœ¼ë¯€ë¡œ colspan ìˆ˜ì • #}
      <tr><td colspan="4" class="py-4 text-center">ì €ì¥ëœ íŒŒì¼ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>
      {% endfor %}
    </tbody>
  </table>

  {# í˜ì´ì§€ë„¤ì´ì…˜ UI for recent_db_files #}
  {% if recent_db_files.has_other_pages %}
  <div class="mt-4 flex justify-center">
      <nav aria-label="Page navigation">
          <ul class="inline-flex items-center -space-x-px">
              {% if recent_db_files.has_previous %}
              <li>
                  <a href="?page=1" class="px-3 py-2 ml-0 leading-tight text-gray-500 bg-white border border-gray-300 rounded-l-lg hover:bg-gray-100 hover:text-gray-700">
                      <span class="sr-only">First</span>&laquo;
                  </a>
              </li>
              <li>
                  <a href="?page={{ recent_db_files.previous_page_number }}" class="px-3 py-2 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700">
                      <span class="sr-only">Previous</span>&lsaquo;
                  </a>
              </li>
              {% else %}
              <li>
                  <span class="px-3 py-2 ml-0 leading-tight text-gray-300 bg-white border border-gray-300 rounded-l-lg cursor-not-allowed"><span class="sr-only">First</span>&laquo;</span>
              </li>
              <li>
                  <span class="px-3 py-2 leading-tight text-gray-300 bg-white border border-gray-300 cursor-not-allowed"><span class="sr-only">Previous</span>&lsaquo;</span>
              </li>
              {% endif %}

              <li aria-current="page">
                  <span class="px-3 py-2 text-indigo-600 border border-indigo-300 bg-indigo-50 hover:bg-indigo-100 hover:text-indigo-700">
                      {{ recent_db_files.number }} / {{ recent_db_files.paginator.num_pages }}
                  </span>
              </li>

              {% if recent_db_files.has_next %}
              <li>
                  <a href="?page={{ recent_db_files.next_page_number }}" class="px-3 py-2 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700">
                      <span class="sr-only">Next</span>&rsaquo;
                  </a>
              </li>
              <li>
                  <a href="?page={{ recent_db_files.paginator.num_pages }}" class="px-3 py-2 leading-tight text-gray-500 bg-white border border-gray-300 rounded-r-lg hover:bg-gray-100 hover:text-gray-700">
                      <span class="sr-only">Last</span>&raquo;
                  </a>
              </li>
              {% else %}
              <li>
                  <span class="px-3 py-2 leading-tight text-gray-300 bg-white border border-gray-300 cursor-not-allowed"><span class="sr-only">Next</span>&rsaquo;</span>
              </li>
              <li>
                  <span class="px-3 py-2 leading-tight text-gray-300 bg-white border border-gray-300 rounded-r-lg cursor-not-allowed"><span class="sr-only">Last</span>&raquo;</span>
              </li>
              {% endif %}
          </ul>
      </nav>
  </div>
  {% endif %}

</div>
{% endblock %}